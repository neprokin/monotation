# üîî –ü—Ä–æ–±–ª–µ–º–∞ –≤–∏–±—Ä–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –º–µ–¥–∏—Ç–∞—Ü–∏–∏ –Ω–∞ Apple Watch

## üìã –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏

**–¶–µ–ª—å**: –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —É–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –º–µ–¥–∏—Ç–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –≤–∏–±—Ä–∞—Ü–∏—é, –¥–∞–∂–µ –∫–æ–≥–¥–∞ —ç–∫—Ä–∞–Ω Apple Watch –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (AOD/wrist-down —Ä–µ–∂–∏–º).

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å**: ‚úÖ **–†–ï–®–ï–ù–û –ò –†–ê–ë–û–¢–ê–ï–¢** (2026-01-08). Smart Alarm ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è –Ω–∞ Watch. –í–∞—Ä–∏–∞–Ω—Ç A (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∫–∞–∑ CompletionView –ø—Ä–∏ "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å") —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç.

---

## üèÜ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê: Smart Alarm (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è)

### –ü–æ—á–µ–º—É Smart Alarm?

–ü—Ä–µ–¥—ã–¥—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ (Timer + Local Notifications) —Ä–∞–±–æ—Ç–∞–ª–æ, –Ω–æ –±—ã–ª–æ "—á—ë—Ä–Ω—ã–º —è—â–∏–∫–æ–º" ‚Äî –º—ã –Ω–µ –ø–æ–Ω–∏–º–∞–ª–∏ —Ç–æ—á–Ω–æ –ø–æ—á–µ–º—É –∏ –∫–æ–≥–¥–∞ haptic "–ø—Ä–æ–±–∏–≤–∞–µ—Ç—Å—è". 

**WKExtendedRuntimeSession (Smart Alarm)** ‚Äî —ç—Ç–æ **—Å–∏—Å—Ç–µ–º–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º "–±—É–¥–∏–ª—å–Ω–∏–∫–∞"**, –∫–æ—Ç–æ—Ä—ã–π:
1. –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è (–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Timer)
2. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `notifyUser(hapticType:repeatHandler:)` –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–≥–æ—Å—è haptic
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π UI —Å –∫–Ω–æ–ø–∫–æ–π Stop
4. –†–∞–±–æ—Ç–∞–µ—Ç **–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –Ω–∞–¥—ë–∂–Ω–æ** –≤ AOD/wrist-down

**–í–∞–∂–Ω–æ**: Smart Alarm ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –Ω–∞–¥—ë–∂–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å–ø–æ—Å–æ–± –Ω–∞ watchOS –¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è —Å–∏–≥–Ω–∞–ª –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è. –ù–æ –µ—Å—Ç—å —Å–∏—Å—Ç–µ–º–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ: –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å force-quit –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, watchOS –º–æ–∂–µ—Ç –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ –¥–ª—è alarm-—Å—Ü–µ–Ω–∞—Ä–∏—è. –ü–æ—ç—Ç–æ–º—É iPhone fallback –Ω–µ–æ–±—Ö–æ–¥–∏–º. –¢–æ –µ—Å—Ç—å "–∂–µ–ª–µ–∑–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è" = "–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª".

### –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     –ö–û–ù–¢–£–† 1 (–ï–î–ò–ù–°–¢–í–ï–ù–ù–ê–Ø –ì–ê–†–ê–ù–¢–ò–Ø)             ‚îÇ
‚îÇ                     Smart Alarm (Watch)                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  MeditationAlarmController.scheduleAlarm(at: endDate)           ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  –ù–∞ T_end:                                                       ‚îÇ
‚îÇ    ‚Üí extendedRuntimeSessionDidStart()                           ‚îÇ
‚îÇ    ‚Üí notifyUser(hapticType:repeatHandler:)                      ‚îÇ
‚îÇ    ‚Üí –°–∏—Å—Ç–µ–º–Ω—ã–π –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è haptic –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è            ‚îÇ
‚îÇ    ‚Üí –°–∏—Å—Ç–µ–º–Ω—ã–π UI —Å –∫–Ω–æ–ø–∫–æ–π Stop                                ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  –≠—Ç–æ –ñ–ï–õ–ï–ó–ù–ê–Ø –ì–ê–†–ê–ù–¢–ò–Ø –Ω–∞ Watch!                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     –ö–û–ù–¢–£–† 2 (FALLBACK)                         ‚îÇ
‚îÇ                     Time-Sensitive Notification (iPhone)        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  NotificationService.scheduleTimerCompletionNotification()      ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  –û–¥–Ω–æ time-sensitive —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ T_end                         ‚îÇ
‚îÇ  –ù–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ Watch –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (off, not on wrist, force-quit)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     –ö–û–ù–¢–£–† 3 (–í–ò–ó–£–ê–õ–¨–ù–´–ô)                       ‚îÇ
‚îÇ                     Timer –¥–ª—è UI (Watch)                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Timer –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á—ë—Ç–∞         ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  –ù–ï –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ UX!         ‚îÇ
‚îÇ  + UX haptic —á–µ—Ä–µ–∑ WKInterfaceDevice.play(.start) –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û**: 
- –ù–∞ Watch **–ù–ï–¢** fallback —á–µ—Ä–µ–∑ `UNNotification` (—á—Ç–æ–±—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å alarm –∏ –Ω–µ –ª–æ–≤–∏—Ç—å –ø–æ–¥–∞–≤–ª–µ–Ω–∏—è/–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É).
- Watch fallback ‚Äî —Ç–æ–ª—å–∫–æ Smart Alarm.
- iPhone fallback ‚Äî –æ–¥–Ω–æ time-sensitive —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–∏–ª–∏ AlarmKit).

–ù–µ –¥–µ—Ä–∂–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ "–≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã—Ö" –∫–æ–Ω—Ç—É—Ä–æ–≤ –Ω–∞ Watch (Smart Alarm + Local Notifications) ‚Äî —ç—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ —Å—Ç—Ä–∞–Ω–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã. –ü—Ä–∞–≤–∏–ª—å–Ω–æ: Smart Alarm = –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è –Ω–∞ Watch, –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî UX –∏–ª–∏ —Ä–µ–∑–µ—Ä–≤ –Ω–∞ iPhone.

### –ü—Ä–∞–≤–∏–ª–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

**–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ = Stop –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–º alarm UI** (—ç—Ç–æ –∏ –µ—Å—Ç—å "–ø–æ–∫–∞ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç").

**–í–∞—Ä–∏–∞–Ω—Ç A (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç)**: –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å" –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–º —ç–∫—Ä–∞–Ω–µ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º `CompletionView` (–±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ —Å –∫–Ω–æ–ø–∫–æ–π "–ó–∞–≤–µ—Ä—à–∏—Ç—å").

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- `MeditationAlarmController` –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç `wasStoppedBySystem` —Ñ–ª–∞–≥
- –ü—Ä–∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ Smart Alarm —Å `reason == .none` (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å") ‚Üí —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º `wasStoppedBySystem = true`
- `ActiveMeditationView` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–ª–∞–≥ –≤ `onAppear` –∏ —á–µ—Ä–µ–∑ `onChange(of: wasStoppedBySystem)`
- –ï—Å–ª–∏ —Ñ–ª–∞–≥ `true` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º `CompletionView`, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º timer –∏ workout

State machine:
- Smart Alarm –∞–∫—Ç–∏–≤–µ–Ω ‚Üí –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è haptic –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å" ‚Üí `extendedRuntimeSession(_:didInvalidateWith:reason:.none)` ‚Üí `wasStoppedBySystem = true` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º `CompletionView` ‚úÖ
- –ò–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ "–û—Ç–∫—Ä—ã—Ç—å" ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç UI "–ó–∞–≤–µ—Ä—à–∏—Ç—å" ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç ‚Üí –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º —Å–µ—Å—Å–∏—é ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º `CompletionView`

### –°–∏—Å—Ç–µ–º–Ω—ã–π UI Smart Alarm

**–ß—Ç–æ —ç—Ç–æ**: –°–∏—Å—Ç–µ–º–Ω—ã–π —ç–∫—Ä–∞–Ω, –∫–æ—Ç–æ—Ä—ã–π –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ Smart Alarm. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –ò–∫–æ–Ω–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–∏–∑ `AppIcon`)
- –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ö–Ω–æ–ø–∫–∏ "–û—Ç–∫—Ä—ã—Ç—å" –∏ "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å"

**–ß—Ç–æ –º–æ–∂–Ω–æ –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å**:
1. **–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**: –ß–µ—Ä–µ–∑ `CFBundleDisplayName` –≤ `Info.plist` Watch App
   ```xml
   <key>CFBundleDisplayName</key>
   <string>–ú–µ–¥–∏—Ç–∞—Ü–∏—è</string>
   ```
   –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `CFBundleName` (–æ–±—ã—á–Ω–æ "monotation Watch App")

2. **–ò–∫–æ–Ω–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**: –ß–µ—Ä–µ–∑ `AppIcon` –≤ `Assets.xcassets` Watch App

**–ß—Ç–æ –Ω–µ–ª—å–∑—è –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å**:
- –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–æ–∫ ("–û—Ç–∫—Ä—ã—Ç—å", "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å") ‚Äî —Å–∏—Å—Ç–µ–º–Ω—ã–µ
- –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ ‚Äî —Å–∏—Å—Ç–µ–º–Ω–æ–µ
- –°—Ç–∏–ª—å UI ‚Äî —Å–∏—Å—Ç–µ–º–Ω—ã–π

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**:
- "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å" ‚Üí `extendedRuntimeSession(_:didInvalidateWith:reason:.none)` ‚Üí `wasStoppedBySystem = true` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º `CompletionView` (–í–∞—Ä–∏–∞–Ω—Ç A)
- "–û—Ç–∫—Ä—ã—Ç—å" ‚Üí –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º UI "–ó–∞–≤–µ—Ä—à–∏—Ç—å" ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º `CompletionView`

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏**:
- `üëÜ [Alarm] Session invalidated - reason: X, userStopped: true/false` ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏—á–∏–Ω—É –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏
- `‚úÖ [Alarm] User stopped alarm via system UI 'Stop' button` ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- `üîÑ [ActiveMeditation] wasStoppedBySystem changed to true` ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–ª–∞–≥–∞
- `üîç [ActiveMeditation] Checking wasStoppedBySystem: true/false` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–ª–∞–≥–∞
- `‚úÖ [ActiveMeditation] User stopped via system UI - showing completion immediately` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∫–∞–∑ CompletionView

### –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| `MeditationAlarmController.swift` | Smart Alarm session + notifyUser + –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ `wasStoppedBySystem` |
| `MainView.swift` | **–ü–ª–∞–Ω–∏—Ä—É–µ—Ç Smart Alarm –î–û workout session** |
| `ActiveMeditationView.swift` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç/–ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä—É–µ—Ç Smart Alarm + Timer (UI) + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∫–∞–∑ CompletionView (–í–∞—Ä–∏–∞–Ω—Ç A) |
| `NotificationService.swift` (iPhone) | Time-sensitive fallback notification |
| `monotation-Watch-App-Watch-App-Info.plist` | WKBackgroundModes: `alarm` + `CFBundleDisplayName` –¥–ª—è –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è |

### Info.plist (Watch)

```xml
<key>WKBackgroundModes</key>
<array>
    <string>alarm</string>
</array>
<key>CFBundleDisplayName</key>
<string>–ú–µ–¥–∏—Ç–∞—Ü–∏—è</string>
```

**–ü—Ä–∞–≤–∏–ª–æ**: –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ —Ä–µ–∂–∏–º—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º (–∏ –º–æ–∂–µ–º –æ–±—ä—è—Å–Ω–∏—Ç—å —Ä–µ–≤—å—é).

**–ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è**:
- `CFBundleDisplayName` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–º —ç–∫—Ä–∞–Ω–µ Smart Alarm (–≤–º–µ—Å—Ç–æ "monotation Watch App")
- `alarm` ‚Äî –¥–ª—è Smart Alarm –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º–µ–¥–∏—Ç–∞—Ü–∏–∏

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û**: 
- **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º `mindfulness`** ‚Äî `HKWorkoutSession` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç Extended Runtime Session –¥–ª—è HealthKit, –ø–æ—ç—Ç–æ–º—É —è–≤–Ω—ã–π `mindfulness` –Ω–µ –Ω—É–∂–µ–Ω.
- **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º `mindfulness` –∏ `alarm` –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ** ‚Äî –æ–Ω–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç (–æ–±–∞ —è–≤–ª—è—é—Ç—Å—è "session type values"), watchOS –≤—ã–¥–∞—Å—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∏ Smart Alarm –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `alarm`, –∞ –Ω–µ `smart-alarm` (—ç—Ç–æ –Ω–µ –≤–∞–ª–∏–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ background mode).

---

## ‚úÖ –§–ò–ù–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï (2026-01-08)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**Watch:**
- `WKExtendedRuntimeSession` —Å `WKBackgroundModes = alarm`
- **–ö–†–ò–¢–ò–ß–ù–û**: –ü–ª–∞–Ω–∏—Ä—É–µ–º Smart Alarm –≤ `MainView.startCountdown()` **–î–û** —Å—Ç–∞—Ä—Ç–∞ workout session (–ø–æ–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ)
  - `endDate = Date() + countdownDuration (4s) + meditationDuration`
  - `alarmController.scheduleAlarm(at: endDate)` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –¥–æ `Task { @MainActor in }`
- –í `ActiveMeditationView.startTimer()`: –ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω –ª–∏ —É–∂–µ Smart Alarm (fallback, –µ—Å–ª–∏ –Ω–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω)
- –ù–∞ `pause/resume`: –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä—É–µ–º alarm –Ω–∞ –Ω–æ–≤—ã–π `endDate` (–≤ `ActiveMeditationView`)
- –ù–∞ `stop`: –æ—Ç–º–µ–Ω—è–µ–º alarm —á–µ—Ä–µ–∑ `MeditationAlarmController.cancelAlarm()`
- –ù–∞ `T_end`: `extendedRuntimeSessionDidStart()` ‚Üí `notifyUser(...repeat...)` ‚Üí –ø–æ–≤—Ç–æ—Ä—è–µ–º haptic –¥–æ Stop
- Timer —Ç–æ–ª—å–∫–æ –¥–ª—è UI (–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á—ë—Ç–∞), –ù–ï –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏
- **Persisted alarm**: –æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–º–µ–¥–∏—Ç–∞—Ü–∏—è –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞)

**iPhone:**
- –û–¥–Ω–æ time-sensitive —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ `endDate` –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤
- –û—Ç–º–µ–Ω—è–µ–º –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –Ω–∞ Watch (–µ—Å–ª–∏ —Å–≤—è–∑—å –¥–æ—Å—Ç—É–ø–Ω–∞)

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –†–æ–ª—å | –§–∞–π–ª |
|-----------|------|------|
| `MeditationAlarmController` | Smart Alarm session + notifyUser | `MeditationAlarmController.swift` |
| `MainView.startCountdown()` | **–ü–ª–∞–Ω–∏—Ä—É–µ—Ç Smart Alarm –î–û workout session** | `MainView.swift` |
| `ActiveMeditationView.startTimer()` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç/–ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä—É–µ—Ç Smart Alarm (fallback) | `ActiveMeditationView.swift` |
| `Timer` | –¢–æ–ª—å–∫–æ –¥–ª—è UI (–æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç) | `ActiveMeditationView.swift` |
| `NotificationService` (iPhone) | Time-sensitive fallback | `NotificationService.swift` |

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ Smart Alarm –î–û workout session**:
   - Smart Alarm —Ç—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—ã–ª–æ –∞–∫—Ç–∏–≤–Ω—ã–º (foreground) –ø—Ä–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
   - –ï—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ workout session, –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∞ "app not in required app state"
   - –†–µ—à–µ–Ω–∏–µ: –ø–ª–∞–Ω–∏—Ä—É–µ–º –≤ `MainView.startCountdown()` —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –¥–æ `Task { @MainActor in }`

2. **Persisted alarm –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ**:
   - –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–µ–¥–∏—Ç–∞—Ü–∏—è –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞, persisted alarm –Ω–µ –Ω—É–∂–µ–Ω
   - –û—á–∏—â–∞–µ–º –µ–≥–æ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ —Å–µ—Å—Å–∏—è–º–∏
   - –û—à–∏–±–∫–∞ "only single session allowed" –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –µ—Å–ª–∏ –ø—ã—Ç–∞—Ç—å—Å—è –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å persisted alarm –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π workout session

3. **–í–∞—Ä–∏–∞–Ω—Ç A: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∫–∞–∑ CompletionView**:
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —á–µ—Ä–µ–∑ `wasStoppedBySystem` —Ñ–ª–∞–≥ –≤ `MeditationAlarmController`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–ª–∞–≥–∞ –≤ `ActiveMeditationView.onAppear` –∏ —á–µ—Ä–µ–∑ `onChange(of: wasStoppedBySystem)`
   - `onChange` –Ω–µ–æ–±—Ö–æ–¥–∏–º, —Ç–∞–∫ –∫–∞–∫ —Ñ–ª–∞–≥ –º–æ–∂–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø–æ—Å–ª–µ `onAppear` (—á–µ—Ä–µ–∑ `Task { @MainActor in }`)
   - –ü—Ä–∏ `wasStoppedBySystem == true`: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º timer, –∑–∞–≤–µ—Ä—à–∞–µ–º workout, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º `CompletionView`
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º: —Ç–æ–ª—å–∫–æ `reason == .none` (–Ω–µ `.resignedFrontmost`, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ "–û—Ç–∫—Ä—ã—Ç—å")
   - **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å" ‚Üí —Å—Ä–∞–∑—É –≤–∏–¥–∏—Ç `CompletionView` –±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞

---

## üìö –ò–°–¢–û–†–ò–Ø –†–ï–®–ï–ù–ò–Ø (ARCHIVE / Legacy)

---

## üêõ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –°–∏–º–ø—Ç–æ–º—ã
1. –ó–∞–ø—É—Å–∫–∞—é –º–µ–¥–∏—Ç–∞—Ü–∏—é –Ω–∞ 5 –º–∏–Ω—É—Ç
2. –ë–ª–æ–∫–∏—Ä—É—é —ç–∫—Ä–∞–Ω (–æ–ø—É—Å–∫–∞—é —Ä—É–∫—É)
3. –ú–µ–¥–∏—Ç–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è
4. **–ë—ã–ª–æ 2 –≤–∏–±—Ä–∞—Ü–∏–∏, –ø–æ—Ç–æ–º —Ç–∏—à–∏–Ω–∞**
5. –ü—Ä–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–µ (–ø–æ–¥–Ω–∏–º–∞—é —Ä—É–∫—É) ‚Äî –≤–∏–±—Ä–∞—Ü–∏–∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- –í–∏–±—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å—Å—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- –ò–ª–∏ –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ —Å–∏—Å—Ç–µ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–æ –∑–≤—É–∫–æ–º/–≤–∏–±—Ä–∞—Ü–∏–µ–π

---

## üìö –ò—Å—Ç–æ—Ä–∏—è —Ä–µ—à–µ–Ω–∏—è

### –≠—Ç–∞–ø 1: –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–ü–æ–¥—Ö–æ–¥**: –ü—Ä–æ—Å—Ç–æ–π haptic –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ç–∞–π–º–µ—Ä–∞

```swift
private func timerCompleted() {
    WKInterfaceDevice.current().play(.success)
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —ç–∫—Ä–∞–Ω–µ

**–ü—Ä–∏—á–∏–Ω–∞**: `WKInterfaceDevice.play()` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ background/inactive —Å–æ—Å—Ç–æ—è–Ω–∏–∏

---

### –≠—Ç–∞–ø 2: Repeating Haptic Timer

**–ü–æ–¥—Ö–æ–¥**: –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –≤–∏–±—Ä–∞—Ü–∏–∏ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É —á–µ—Ä–µ–∑ Timer

```swift
private func startCompletionSignals() {
    let signalTimer = Timer(timeInterval: 1.0, repeats: true) { _ in
        WKInterfaceDevice.current().play(.notification)
    }
    RunLoop.main.add(signalTimer, forMode: .common)
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚ùå –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ 1-2 —Å–µ–∫—É–Ω–¥—ã, –ø–æ—Ç–æ–º –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞**: Timer –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ `WKInterfaceDevice.play()` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–æ–π –≤ AOD —Ä–µ–∂–∏–º–µ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –±–∞—Ç–∞—Ä–µ–∏

---

### –≠—Ç–∞–ø 3: Local Notification –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

**–ü–æ–¥—Ö–æ–¥**: –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å Local Notification –≤ –º–æ–º–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–µ–¥–∏—Ç–∞—Ü–∏–∏

```swift
private func sendCompletionNotification() {
    let content = UNMutableNotificationContent()
    content.title = "–ú–µ–¥–∏—Ç–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
    content.sound = .default
    content.interruptionLevel = .timeSensitive
    
    let trigger = UNTimeIntervalNotificationTrigger(timeInterval: 0.1, repeats: false)
    // ...
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚ùå –ù–µ–Ω–∞–¥—ë–∂–Ω–æ ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–∂–µ –≤ background, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–æ–∂–µ—Ç –Ω–µ –¥–æ—Å—Ç–∞–≤–∏—Ç—å—Å—è

**–ü—Ä–∏—á–∏–Ω–∞**: –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–∂–µ –≤ inactive —Å–æ—Å—Ç–æ—è–Ω–∏–∏

---

### –≠—Ç–∞–ø 4: "–î–≤—É—Ö–∫–æ–Ω—Ç—É—Ä–Ω–∞—è" —Å—Ö–µ–º–∞ (—Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)

**–ü–æ–¥—Ö–æ–¥**: –ü–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ó–ê–†–ê–ù–ï–ï –Ω–∞ –≤—Ä–µ–º—è T_end

**–§–∏–ª–æ—Å–æ—Ñ–∏—è**:
- **–ö–æ–Ω—Ç—É—Ä 1 (–°–∏—Å—Ç–µ–º–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è)**: –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–æ–π –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **–ö–æ–Ω—Ç—É—Ä 2 (–ö—Ä–∞—Å–∏–≤—ã–π UX)**: –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ ‚Äî –∏–≥—Ä–∞–µ–º haptic –Ω–∞–ø—Ä—è–º—É—é –∏ –æ—Ç–º–µ–Ω—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

```swift
// –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –º–µ–¥–∏—Ç–∞—Ü–∏–∏ - –ø–ª–∞–Ω–∏—Ä—É–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ T_end
private func startTimer() {
    scheduleEndNotification(after: timeRemaining)  // –ö–æ–Ω—Ç—É—Ä 1
    WKInterfaceDevice.current().play(.start)       // –ö–æ–Ω—Ç—É—Ä 2
    // –ó–∞–ø—É—Å–∫ Timer...
}

// –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ - –æ—Ç–º–µ–Ω—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã) –∏ –∏–≥—Ä–∞–µ–º haptic
private func timerCompleted() {
    cancelEndNotification()      // –û—Ç–º–µ–Ω—è–µ–º, —Ç.–∫. —Å–∞–º–∏ –æ–±—Ä–∞–±–æ—Ç–∞–µ–º
    startCompletionSignals()     // –ö–æ–Ω—Ç—É—Ä 2 - haptic –Ω–∞–ø—Ä—è–º—É—é
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü—Ä–∏ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ç–µ—Å—Ç–∞—Ö ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ùå –ü—Ä–∏ 5 –º–∏–Ω—É—Ç–∞—Ö ‚Äî —Ç–æ–ª—å–∫–æ 2 –≤–∏–±—Ä–∞—Ü–∏–∏, –ø–æ—Ç–æ–º —Ç–∏—à–∏–Ω–∞

---

## üîç –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π –ø—Ä–æ–±–ª–µ–º—ã

### –ì–∏–ø–æ—Ç–µ–∑—ã

#### –ì–∏–ø–æ—Ç–µ–∑–∞ 1: Timer –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 2-3 –º–∏–Ω—É—Ç—ã
watchOS –º–æ–∂–µ—Ç "—É—Å—ã–ø–ª—è—Ç—å" Timer –¥–∞–∂–µ —Å `.common` mode –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≤ background.

**–ü—Ä–æ–≤–µ—Ä–∫–∞**: –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ tick —Ç–∞–π–º–µ—Ä–∞

#### –ì–∏–ø–æ—Ç–µ–∑–∞ 2: HKWorkoutSession –∏—Å—Ç–µ–∫–∞–µ—Ç
Extended Runtime Session –æ—Ç HKWorkoutSession –º–æ–∂–µ—Ç –∏—Å—Ç–µ–∫–∞—Ç—å —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç.

**–ü—Ä–æ–≤–µ—Ä–∫–∞**: –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å `runtimeManager.isActive`

#### –ì–∏–ø–æ—Ç–µ–∑–∞ 3: –°–∏—Å—Ç–µ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è
–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–æ–∂–µ—Ç –Ω–µ –¥–æ—Å—Ç–∞–≤–ª—è—Ç—å—Å—è –∏–∑-–∑–∞:
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç–∞ —Å –¥—Ä—É–≥–∏–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
- –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π watchOS

**–ü—Ä–æ–≤–µ—Ä–∫–∞**: –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç `center.add(request)`

#### –ì–∏–ø–æ—Ç–µ–∑–∞ 4: `timerCompleted()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏ –æ—Ç–º–µ–Ω—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
–ï—Å–ª–∏ Timer –≤—Å—ë-—Ç–∞–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `timerCompleted()`, –º—ã —Å–∞–º–∏ –æ—Ç–º–µ–Ω—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:
```swift
private func timerCompleted() {
    cancelEndNotification()  // <-- –ú–æ–∂–µ—Ç –æ—Ç–º–µ–Ω—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–æ –µ–≥–æ –¥–æ—Å—Ç–∞–≤–∫–∏
    // ...
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞**: –ù–µ –æ—Ç–º–µ–Ω—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ `timerCompleted()`, –ø—É—Å—Ç—å –ø—Ä–∏–¥—ë—Ç

---

## üìÅ –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (ARCHIVE)

**‚ö†Ô∏è –£–°–¢–ê–†–ï–í–®–ï–ï** ‚Äî –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Local Notifications. –¢–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ: Smart Alarm (—Å–º. "–§–ò–ù–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï" –≤—ã—à–µ).

---

## ü§î –ö–ª—é—á–µ–≤–æ–π –≤–æ–ø—Ä–æ—Å

**–ü–æ—á–µ–º—É –ø—Ä–∏ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ç–µ—Å—Ç–∞—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç, –∞ –ø—Ä–∏ 5 –º–∏–Ω—É—Ç–∞—Ö ‚Äî –Ω–µ—Ç?**

–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
1. –ü—Ä–∏ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ç–µ—Å—Ç–∞—Ö —ç–∫—Ä–∞–Ω –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é "–∑–∞—Å–Ω—É—Ç—å"
2. HKWorkoutSession –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –≤ background
3. watchOS –ø—Ä–∏–º–µ–Ω—è–µ—Ç –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —ç–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–∏–Ω—É—Ç

---

## üîß –≠—Ç–∞–ø 5: NotificationDelegate + –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (ARCHIVE)

### –ü—Ä–æ–±–ª–µ–º–∞ –Ω–∞–π–¥–µ–Ω–∞

**Local Notifications –Ω–∞ watchOS –ø–æ–¥–∞–≤–ª—è—é—Ç—Å—è –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ!**

–ö–æ–≥–¥–∞ HKWorkoutSession –¥–µ—Ä–∂–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ "–∂–∏–≤—ã–º" –≤ background:
- Timer —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
- `timerCompleted()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è ‚úÖ
- Local Notification **–Ω–µ –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è** ‚ùå (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ)
- `WKInterfaceDevice.play()` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ AOD ‚ùå

### –†–µ—à–µ–Ω–∏–µ

1. **UNUserNotificationCenterDelegate** ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–∞–∂–µ –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ
2. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** ‚Äî –ø–ª–∞–Ω–∏—Ä—É–µ–º 3 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (T_end, T_end+5s, T_end+10s) –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏
3. **Critical Alert permission** ‚Äî –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –ö–ª—é—á–µ–≤–æ–π –∫–æ–¥

```swift
// –í App - –¥–µ–ª–µ–≥–∞—Ç –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ foreground
class NotificationDelegate: NSObject, UNUserNotificationCenterDelegate {
    func userNotificationCenter(
        _ center: UNUserNotificationCenter,
        willPresent notification: UNNotification,
        withCompletionHandler completionHandler: @escaping (UNNotificationPresentationOptions) -> Void
    ) {
        // .sound –Ω–∞ watchOS = haptic
        completionHandler([.banner, .sound])
    }
}

// –í ActiveMeditationView - –ø–ª–∞–Ω–∏—Ä—É–µ–º 3 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
private func scheduleEndNotification(after seconds: TimeInterval) {
    let delays: [(String, TimeInterval)] = [
        (Self.endNotificationId, 0),
        (Self.endNotificationId2, 5),
        (Self.endNotificationId3, 10)
    ]
    
    for (id, delay) in delays {
        // ... –ø–ª–∞–Ω–∏—Ä—É–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ seconds + delay
    }
}
```

### –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏ —Ç–µ–ø–µ—Ä—å

| –°—Ü–µ–Ω–∞—Ä–∏–π | –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ |
|----------|---------------------|
| Wrist-up (—ç–∫—Ä–∞–Ω –∞–∫—Ç–∏–≤–µ–Ω) | Haptic –Ω–∞–ø—Ä—è–º—É—é + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –±–ª–∞–≥–æ–¥–∞—Ä—è delegate |
| Wrist-down (AOD) | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –æ—Ç —Å–∏—Å—Ç–µ–º—ã (3 —à—Ç—É–∫–∏ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 5—Å) |
| –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ | delegate –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–æ –∑–≤—É–∫–æ–º/haptic |

---

## üìù –ß—Ç–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –í–∞—Ä–∏–∞–Ω—Ç A: WKExtendedRuntimeSession —Ç–∏–ø–∞ .smartAlarm
–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–∏–ø —Å–µ—Å—Å–∏–∏ –¥–ª—è alarm-–ø–æ–¥–æ–±–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (—Ç—Ä–µ–±—É–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è Apple).

### –í–∞—Ä–∏–∞–Ω—Ç B: –û—Ç–∫–ª—é—á–∏—Ç—å HKWorkoutSession –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º
–ß—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å—Ç–∞–ª–æ "–Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º" –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –ø—Ä–∏—à–ª–æ.

```swift
private func timerCompleted() {
    workoutManager.endWorkout()  // –°–ù–ê–ß–ê–õ–ê –∑–∞–≤–µ—Ä—à–∞–µ–º workout
    // –ñ–¥—ë–º –ø–æ–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å—Ç–∞–Ω–µ—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º
    // –¢–æ–≥–¥–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –ø—Ä–∏–¥—ë—Ç
}
```

### –í–∞—Ä–∏–∞–Ω—Ç C: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ:
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- "Show Notifications on Wrist Down" –≤–∫–ª—é—á–µ–Ω–æ
- Haptic Alerts –≤–∫–ª—é—á–µ–Ω—ã –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Watch

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:
- `HKWorkoutSession` ‚Äî –¥–ª—è Extended Runtime Session
- `WKInterfaceDevice.play()` ‚Äî –¥–ª—è haptic feedback
- `UNUserNotificationCenter` ‚Äî –¥–ª—è Local Notifications
- `Timer` —Å `RunLoop.main.add(..., forMode: .common)` ‚Äî –¥–ª—è background-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–≥–æ —Ç–∞–π–º–µ—Ä–∞

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è watchOS:
- `WKInterfaceDevice.play()` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ background/inactive
- Timer –º–æ–∂–µ—Ç –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è –≤ –≥–ª—É–±–æ–∫–æ–º sleep
- AOD —Ä–µ–∂–∏–º –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç haptic –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –±–∞—Ç–∞—Ä–µ–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Apple:
- [WKExtendedRuntimeSession](https://developer.apple.com/documentation/watchkit/wkextendedruntimesession)
- [Playing haptics](https://developer.apple.com/documentation/watchkit/wkinterfacedevice/2927925-play)
- [Local Notifications](https://developer.apple.com/documentation/usernotifications)

---

## üìä –õ–æ–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

–ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º —Ç–µ—Å—Ç–µ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞:

```
üìÖ [ActiveMeditation] Scheduled end notification for Xs from now
üîî [ActiveMeditation] Starting repeating completion signals
üì≥ [ActiveMeditation] Playing COMPLETION haptic (session active: true/false)
üö´ [ActiveMeditation] Cancelled pending end notification
```

–ö–ª—é—á–µ–≤–æ–π –≤–æ–ø—Ä–æ—Å: –ø—Ä–∏—Ö–æ–¥–∏—Ç –ª–∏ —Å–∏—Å—Ç–µ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –∏–ª–∏ –æ–Ω–æ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è –¥–æ –¥–æ—Å—Ç–∞–≤–∫–∏?

---

## üìÖ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –î–∞—Ç–∞ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|------|-----------|-----------|
| 2026-01-07 | –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è haptic | ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ background |
| 2026-01-07 | –î–æ–±–∞–≤–ª–µ–Ω repeating timer | ‚ùå –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 1-2 —Å–µ–∫ |
| 2026-01-07 | –î–æ–±–∞–≤–ª–µ–Ω Local Notification –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ | ‚ùå –ù–µ–Ω–∞–¥—ë–∂–Ω–æ |
| 2026-01-07 | –î–≤—É—Ö–∫–æ–Ω—Ç—É—Ä–Ω–∞—è —Å—Ö–µ–º–∞ (–∑–∞—Ä–∞–Ω–µ–µ –ø–ª–∞–Ω–∏—Ä—É–µ–º) | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| 2026-01-07 | FIX: –ù–µ –æ—Ç–º–µ–Ω—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ timerCompleted() | ‚ùå –ù–µ –ø–æ–º–æ–≥–ª–æ |
| 2026-01-08 | NotificationDelegate + –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è | ‚ö†Ô∏è –†–∞–±–æ—Ç–∞–ª–æ, –Ω–æ "—á—ë—Ä–Ω—ã–π —è—â–∏–∫" |
| 2026-01-08 | **–§–ò–ù–ê–õ: Smart Alarm (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è)** | ‚úÖ **–ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –ù–ê–î–Å–ñ–ù–û** |

---

**‚ö†Ô∏è –£–°–¢–ê–†–ï–í–®–ï–ï –†–ï–®–ï–ù–ò–ï** ‚Äî –æ—Å—Ç–∞–≤–ª–µ–Ω–æ –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏. –¢–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ: Smart Alarm (—Å–º. –≤—ã—à–µ).

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ–ø—ã—Ç–∫–∏ —Ä–µ—à–µ–Ω–∏—è —á–µ—Ä–µ–∑ Local Notifications + Timer, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞–ª–∏, –Ω–æ –±—ã–ª–∏ "—á—ë—Ä–Ω—ã–º —è—â–∏–∫–æ–º" –∏ —Å–æ–∑–¥–∞–≤–∞–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã.

---

## üéØ –¶–µ–ª—å

‚úÖ **–î–û–°–¢–ò–ì–ù–£–¢–û** ‚Äî Smart Alarm —Ä–∞–±–æ—Ç–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –Ω–∞–¥—ë–∂–Ω–æ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª:
- ‚úÖ –ü–æ–ª–æ–∂–µ–Ω–∏—è —Ä—É–∫–∏ (wrist-up / wrist-down)
- ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏—è —ç–∫—Ä–∞–Ω–∞ (–∞–∫—Ç–∏–≤–µ–Ω / AOD)
- ‚úÖ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–µ–¥–∏—Ç–∞—Ü–∏–∏
- ‚ö†Ô∏è –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: force-quit –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ç—Ä–µ–±—É–µ—Ç iPhone fallback)

---

## üß™ –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å–∏–≥–Ω–∞–ª–æ–≤ (ARCHIVE)

**‚ö†Ô∏è –£–°–¢–ê–†–ï–í–®–ï–ï** ‚Äî –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è —á–µ—Ä–µ–∑ Local Notifications. –¢–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ: Smart Alarm (—Å–º. "–§–ò–ù–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï" –≤—ã—à–µ).

### –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –º–µ–¥–∏—Ç–∞—Ü–∏–∏ (`startTimer()`):

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ scheduleEndNotification(after: duration)                        ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ –ü–ª–∞–Ω–∏—Ä—É—é—Ç—Å—è 3 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞—Ä–∞–Ω–µ–µ:                              ‚îÇ
‚îÇ   ‚Ä¢ meditation.end    ‚Üí —á–µ—Ä–µ–∑ duration —Å–µ–∫—É–Ω–¥ (T_end)          ‚îÇ
‚îÇ   ‚Ä¢ meditation.end.2  ‚Üí —á–µ—Ä–µ–∑ duration + 5 —Å–µ–∫—É–Ω–¥              ‚îÇ
‚îÇ   ‚Ä¢ meditation.end.3  ‚Üí —á–µ—Ä–µ–∑ duration + 10 —Å–µ–∫—É–Ω–¥             ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ + –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è Timer (–∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É —É–º–µ–Ω—å—à–∞–µ—Ç timeRemaining)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–æ–≥–¥–∞ —Ç–∞–π–º–µ—Ä –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è (`timerCompleted()`):

```swift
// –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ù–ï –æ—Ç–º–µ–Ω—è—é—Ç—Å—è ‚Äî –ø—É—Å—Ç—å –ø—Ä–∏—Ö–æ–¥—è—Ç –æ—Ç —Å–∏—Å—Ç–µ–º—ã
// –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è startCompletionSignals():
//   - –ü–µ—Ä–≤—ã–π haptic —Å—Ä–∞–∑—É
//   - –ó–∞—Ç–µ–º Timer –∫–∞–∂–¥—É—é 1 —Å–µ–∫—É–Ω–¥—É –≤—ã–∑—ã–≤–∞–µ—Ç WKInterfaceDevice.play(.notification)
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π A: wrist-up (—ç–∫—Ä–∞–Ω –∞–∫—Ç–∏–≤–µ–Ω) –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

```
T_end:     üì≥ haptic –æ—Ç startCompletionSignals()
           üì¨ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ meditation.end
           
T_end+1s:  üì≥ haptic
T_end+2s:  üì≥ haptic
T_end+3s:  üì≥ haptic
T_end+4s:  üì≥ haptic

T_end+5s:  üì≥ haptic + üì¨ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ meditation.end.2
...

T_end+10s: üì≥ haptic + üì¨ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ meditation.end.3
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π haptic –∫–∞–∂–¥—É—é 1 —Å–µ–∫—É–Ω–¥—É + 3 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

---

### –°—Ü–µ–Ω–∞—Ä–∏–π B: wrist-down (AOD) –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

```
T_end:     üì¨ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ meditation.end ‚Üí –í–ò–ë–†–ê–¶–ò–Ø
           ‚ö†Ô∏è startCompletionSignals() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, Timer —Ä–∞–±–æ—Ç–∞–µ—Ç,
              –Ω–æ WKInterfaceDevice.play() –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù —Å–∏—Å—Ç–µ–º–æ–π!
              
T_end+1s:  (Timer fires, play() –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω ‚Äî —Ç–∏—à–∏–Ω–∞)
T_end+2s:  (Timer fires, play() –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω ‚Äî —Ç–∏—à–∏–Ω–∞)
T_end+3s:  (Timer fires, play() –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω ‚Äî —Ç–∏—à–∏–Ω–∞)
T_end+4s:  (Timer fires, play() –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω ‚Äî —Ç–∏—à–∏–Ω–∞)

T_end+5s:  üì¨ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ meditation.end.2 ‚Üí –í–ò–ë–†–ê–¶–ò–Ø

T_end+6-9s: (Timer fires, play() –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω ‚Äî —Ç–∏—à–∏–Ω–∞)

T_end+10s: üì¨ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ meditation.end.3 ‚Üí –í–ò–ë–†–ê–¶–ò–Ø
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –¢–æ–ª—å–∫–æ 3 –≤–∏–±—Ä–∞—Ü–∏–∏ –æ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (0, +5, +10 —Å–µ–∫)

---

### –°—Ü–µ–Ω–∞—Ä–∏–π C: wrist-down ‚Üí wrist-up (–ø–æ–¥–Ω—è–ª —Ä—É–∫—É)

```
T_end:     üì¨ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚Üí –í–ò–ë–†–ê–¶–ò–Ø
T_end+5s:  üì¨ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚Üí –í–ò–ë–†–ê–¶–ò–Ø
T_end+10s: üì¨ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚Üí –í–ò–ë–†–ê–¶–ò–Ø

T_end+12s: ü§ö –ü–æ–¥–Ω—è–ª —Ä—É–∫—É ‚Üí —ç–∫—Ä–∞–Ω –∞–∫—Ç–∏–≤–µ–Ω!
           Timer –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, —Ç–µ–ø–µ—Ä—å play() —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω:
           
T_end+12s: üì≥ haptic
T_end+13s: üì≥ haptic
T_end+14s: üì≥ haptic
... –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ ...
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: 3 –≤–∏–±—Ä–∞—Ü–∏–∏ ‚Üí –ø–∞—É–∑–∞ ‚Üí –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π haptic –ø–æ—Å–ª–µ –ø–æ–¥–Ω—è—Ç–∏—è —Ä—É–∫–∏

---

### –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞:

| –†–µ–∂–∏–º | `WKInterfaceDevice.play()` | Local Notifications | –ß—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
|-------|---------------------------|---------------------|---------------------------|
| **wrist-up** | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | ‚úÖ –†–∞–±–æ—Ç–∞—é—Ç | Haptic –∫–∞–∂–¥—É—é 1 —Å–µ–∫ + 3 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |
| **wrist-down (AOD)** | ‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω | ‚úÖ –†–∞–±–æ—Ç–∞—é—Ç | –¢–æ–ª—å–∫–æ 3 –≤–∏–±—Ä–∞—Ü–∏–∏ (0, +5, +10 —Å–µ–∫) |
| **wrist-down ‚Üí wrist-up** | ‚ùå ‚Üí ‚úÖ | ‚úÖ | 3 –≤–∏–±—Ä–∞—Ü–∏–∏, –ø–æ—Ç–æ–º –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π haptic |

### –¢–æ—á–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ AOD (wrist-down) ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —Ç–µ—Å—Ç–∞–º–∏

**–ù–∞–±–ª—é–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- 1-3 –≤–∏–±—Ä–∞—Ü–∏–∏ –æ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (—Å –ø–∞—É–∑–∞–º–∏ 5 —Å–µ–∫)
- –ü–æ—Å–ª–µ –æ–¥–Ω–æ–π –∏–∑ –Ω–∏—Ö ‚Äî –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–µ –≤–∏–±—Ä–∞—Ü–∏–∏ –∫–∞–∂–¥—É—é 1 —Å–µ–∫ –æ—Ç Timer
- –≠–∫—Ä–∞–Ω **–æ—Å—Ç–∞—ë—Ç—Å—è —á—ë—Ä–Ω—ã–º** (–Ω–∏–∫–∞–∫–æ–≥–æ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è)
- –†—É–∫–∞ –ù–ï –ø–æ–¥–Ω–∏–º–∞–ª–∞—Å—å!

**–ö–æ–≥–¥–∞ Timer "–ø—Ä–æ–±–∏–≤–∞–µ—Ç—Å—è" ‚Äî –Ω–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–æ:**
- –ò–Ω–æ–≥–¥–∞ –ø–æ—Å–ª–µ 1-–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ò–Ω–æ–≥–¥–∞ –ø–æ—Å–ª–µ 2-–≥–æ
- –ò–Ω–æ–≥–¥–∞ –ø–æ—Å–ª–µ 3-–≥–æ

```
T_end (0s):    üì¨ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ 1 ‚Üí –í–ò–ë–†–ê–¶–ò–Ø –æ—Ç .sound
               ‚ö†Ô∏è Timer —Ä–∞–±–æ—Ç–∞–µ—Ç, play() –º–æ–∂–µ—Ç "–ø—Ä–æ–±–∏—Ç—å—Å—è" –∏–ª–∏ –Ω–µ—Ç
               
T_end+5s:      üì¨ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ 2 ‚Üí –í–ò–ë–†–ê–¶–ò–Ø –æ—Ç .sound
               ‚ö†Ô∏è Timer –º–æ–∂–µ—Ç "–ø—Ä–æ–±–∏—Ç—å—Å—è" –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç
               
T_end+10s:     üì¨ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ 3 ‚Üí –í–ò–ë–†–ê–¶–ò–Ø –æ—Ç .sound
               ‚ö†Ô∏è –ö —ç—Ç–æ–º—É –º–æ–º–µ–Ω—Ç—É Timer –æ–±—ã—á–Ω–æ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
               
–ü–æ—Å–ª–µ "–ø—Ä–æ–±–∏—Ç–∏—è":
               üì≥ Timer ‚Üí –í–ò–ë–†–ê–¶–ò–Ø –∫–∞–∂–¥—É—é 1 —Å–µ–∫ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ
```

**–ì–∏–ø–æ—Ç–µ–∑–∞ –æ –º–µ—Ö–∞–Ω–∏–∑–º–µ:**

–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å `.timeSensitive` + `.sound` –≤—Ä–µ–º–µ–Ω–Ω–æ **"—Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç" haptic API** –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
1. –°–∏—Å—Ç–µ–º–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç haptic –¥–ª—è `.sound` —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
2. –í —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç `WKInterfaceDevice.play()` —Ç–æ–∂–µ –º–æ–∂–µ—Ç —Å—Ä–∞–±–æ—Ç–∞—Ç—å
3. Timer "–ª–æ–≤–∏—Ç" —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
4. –ö–æ–≥–¥–∞ –ø–µ—Ä–≤—ã–π haptic –æ—Ç Timer —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –æ–Ω **–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç** —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫—É
5. –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π —Ü–∏–∫–ª: haptic ‚Üí —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è ‚Üí haptic ‚Üí ...

**–ü–æ—á–µ–º—É –Ω–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–æ:**
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç timing: –∫–æ–≥–¥–∞ –∏–º–µ–Ω–Ω–æ Timer fires –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –º–æ–º–µ–Ω—Ç–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- Race condition –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–Ω—ã–º haptic –∏ –Ω–∞—à–∏–º play()

**–ß—Ç–æ –º—ã –∑–Ω–∞–µ–º —Ç–æ—á–Ω–æ:**
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ AOD (–º–∏–Ω–∏–º—É–º 1-3 –≤–∏–±—Ä–∞—Ü–∏–∏)
- ‚úÖ Timer –≤ –∫–∞–∫–æ–π-—Ç–æ –º–æ–º–µ–Ω—Ç "–ø—Ä–æ–±–∏–≤–∞–µ—Ç—Å—è" –∏ –¥–∞—ë—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π haptic
- ‚úÖ –≠–∫—Ä–∞–Ω –æ—Å—Ç–∞—ë—Ç—Å—è —á—ë—Ä–Ω—ã–º (—ç—Ç–æ –Ω–µ –ø—Ä–æ –¥–∏—Å–ø–ª–µ–π)
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –ø–æ–¥–Ω—è—Ç–∏—è —Ä—É–∫–∏

---

### –í—ã–≤–æ–¥:

**–†–µ—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ!**

- –í AOD —Ä–µ–∂–∏–º–µ `WKInterfaceDevice.play()` –æ–±—ã—á–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å `.sound` –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –¥–∞—é—Ç –≤–∏–±—Ä–∞—Ü–∏—é (—Å–∏—Å—Ç–µ–º–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º)
- Timer –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–ª–∞–≥–æ–¥–∞—Ä—è HKWorkoutSession (Extended Runtime)
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∫-—Ç–æ "—Ä–∞–∑–±–ª–æ–∫–∏—Ä—É—é—Ç" haptic API –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- Timer "–ª–æ–≤–∏—Ç" –º–æ–º–µ–Ω—Ç —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π haptic
- –≠–∫—Ä–∞–Ω –æ—Å—Ç–∞—ë—Ç—Å—è —á—ë—Ä–Ω—ã–º ‚Äî —ç—Ç–æ –ù–ï –ø—Ä–æ –¥–∏—Å–ø–ª–µ–π, –∞ –ø—Ä–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç 1-3 –≤–∏–±—Ä–∞—Ü–∏–∏ –æ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–≥–∞—Ä–∞–Ω—Ç–∏—è)
- –ó–∞—Ç–µ–º –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–µ –≤–∏–±—Ä–∞—Ü–∏–∏ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É (Timer "–ø—Ä–æ–±–∏–≤–∞–µ—Ç—Å—è")
- –í—Å—ë –±–µ–∑ –ø–æ–¥–Ω—è—Ç–∏—è —Ä—É–∫–∏!

---

## üßπ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –±—É–¥—É—â–µ–µ

1. **Smart Alarm ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è –Ω–∞ Watch** ‚Äî –Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å Local Notifications –Ω–∞ Watch –∫–∞–∫ fallback (—Å–æ–∑–¥–∞—ë—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã).

2. **iPhone fallback** ‚Äî –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –¥–æ AlarmKit –¥–ª—è –±–æ–ª–µ–µ "–±—É–¥–∏–ª—å–Ω–∏–∫-–ø–æ–¥–æ–±–Ω–æ–≥–æ" –ø–æ–≤–µ–¥–µ–Ω–∏—è –Ω–∞ iPhone.

3. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ** ‚Äî –≤—Å–µ–≥–¥–∞ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–π Stop –Ω–∞ alarm UI –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏.

